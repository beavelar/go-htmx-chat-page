package main

import "strconv"

import proto "content-service/genproto/database"

templ Message (msg *proto.Message) {
	<div class="chat-message" id="chat-message">
		<p class="chat-item">{ msg.Name }</p>
		<p class="chat-item">{ msg.Message }</p>
		<p class="chat-item">{ strconv.FormatInt(msg.Time, 10) }</p>
	</div>
}

templ MessageInput() {
	<input class="message-input" id="message-input" name="message"/>
	<button class="send-button" type="submit">Send</button>
}

templ Messages(msgs *proto.Messages) {
	<form class="message-input-wrapper" hx-post="/message" hx-swap="innerHTML">
		@MessageInput()
	</form>
	<div hx-ext="ws" ws-connect="/ws/chat">
		<div class="chat-history" id="chat-history">
			for _, msg := range msgs.Messages {
				@Message(msg)
			}
		</div>
		<form style="display: none;" ws-send hx-trigger="every 30s">
			<input name="ping" value="ping"/>
		</form>
	</div>
}

templ MessageUpdate(msg *proto.Message) {
	<div id="chat-history" hx-swap-oob="afterbegin">
		@Message(msg)
	</div>
}
